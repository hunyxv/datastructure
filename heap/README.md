## 堆（Heap）

### 二叉堆

堆就是用数组实现的完全二叉树，所以它没有使用父指针或者子指针。

堆分为两种，将根节点最大的堆叫做最大堆或大根堆，根节点最小的堆叫做最小堆或小根堆：

- 最大堆：各个节点大于或等于其子节点
- 最小堆：各个节点小于或等于其子节点

节点与其子节点、父节点对应关系（i 是当前节点在数组中的索引）：

- 父节点 ![](http://latex.codecogs.com/svg.latex?floor((i-1)/2))
- 左子节点：![](http://latex.codecogs.com/svg.latex?i*2+1)
- 右子节点：![](http://latex.codecogs.com/svg.latex?i*2+2)

n 个结点的堆，深度 ![](https://latex.codecogs.com/svg.latex?h=%5Clog\%20n), 根为第0层，则第i层结点个数为 ![](https://latex.codecogs.com/svg.latex?2^i)，考虑一个元素在堆中向下移动的距离，这种算法时间代价为 Ο(n).

由于堆有 ![](https://latex.codecogs.com/svg.latex?\log%20n) 层深，插入结点、删除普通元素和删除最小元素的平均时间代价和时间复杂度都是 ![](https://latex.codecogs.com/svg.latex?O\log%20n).

如下图为一个最大堆：
![屏幕快照 2020-12-22 下午4.08.29.png](https://i.loli.net/2020/12/22/glfJnV697qCPZGm.png)

其在数组中的顺序为：

||||||||
|:----:|:----:|:----:|:----:|:----:|:----:|:----:|
| 10 | 7 | 9 | 5 | 1 | 2 | 8 |

### 斐波那契堆

斐波那契堆 Fibonacci Heap ：是一系列具有最小堆序 min-heap ordered 的有根树的集合。也就是说，每棵树都遵循最小堆性质 min-heap property：每个节点的关键字大于或等于它的父节点的关键字。（树是无序的，所以并不需要关心树是怎么排序的）。

![0105-fibonacci-heap-sample.png](https://s2.loli.net/2022/03/30/BJZpkVbYoauymq5.png)

- degree(度)：表示一个节点的字节点数；
- marked：记录该节点是否被删除第1个孩子(marked在删除节点时有用)；

#### 插入操作

插入操作非常简单：插入一个节点到堆中，直接将该节点插入到"根链表的min节点"之前即可；若被插入节点比"min节点"小，则更新"min节点"为被插入节点。

斐波那契堆的根链表是"双向链表"，这里将min节点看作双向联表的表头(后文也是如此)。在插入节点时，每次都是"将节点插入到min节点之前(即插入到双链表末尾)"。此外，对于根链表中最小堆都只有一个节点的情况，插入操作就很演化成双向链表的插入操作

#### 合并操作

合并操作和插入操作的原理非常类似：将一个堆的根链表插入到另一个堆的根链表上即可。简单来说，就是将两个双链表拼接成一个双向链表。

#### 取出最小节点

抽取最小结点的操作是斐波那契堆中较复杂的操作。

- 将要抽取最小结点的子树都直接串联在根表中；
- 合并所有degree相等的树，直到没有相等的degree的树。

#### 减小节点值

减少斐波那契堆中的节点的键值，这个操作的难点是：如果减少节点后破坏了"最小堆"性质，如何去维护呢？下面对一般性情况进行分析。

- 首先，将"被减小节点"从"它所在的最小堆"剥离出来；然后将"该节点"关联到"根链表"中。 倘若被减小的节点不是单独一个节点，而是包含子树的树根。则是将以"被减小节点"为根的子树从"最小堆"中剥离出来，然后将该树关联到根链表中。
- 接着，对"被减少节点"的原父节点进行"级联剪切"。所谓"级联剪切"，就是在被减小节点破坏了最小堆性质，并被切下来之后；再从"它的父节点"进行递归级联剪切操作。
  - 而级联操作的具体动作则是：若父节点(被减小节点的父节点)的marked标记为false，则将其设为true，然后退出。
  - 否则，将父节点从最小堆中切下来(方式和"切被减小节点的方式"一样)；然后递归对祖父节点进行"级联剪切"。
    （marked标记的作用就是用来标记"该节点的子节点是否有被删除过"，它的作用是来实现级联剪切。而级联剪切的真正目的是为了防止"最小堆"由二叉树演化成链表。）
- 最后，别忘了对根链表的最小节点进行更新。

#### 增加节点值

增加节点值和减少节点值类似，这个操作的难点也是如何维护"最小堆"性质。思路如下：

- 将"被增加节点"的"左孩子和左孩子的所有兄弟"都链接到根链表中。
- 接下来，把"被增加节点"添加到根链表；但是别忘了对其进行级联剪切。

#### 删除节点

删除节点，本文采用了操作是："取出最小节点"和"减小节点值"的组合。

- 先将被删除节点的键值减少。减少后的值要比"原最小节点的值"即可。
- 接着，取出最小节点即可。
